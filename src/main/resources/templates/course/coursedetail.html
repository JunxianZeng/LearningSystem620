<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
    <meta charset="UTF-8">
    <title>视频</title>
    <link rel="stylesheet" href="/css/style.css" type="text/css">
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>

<body>
<!--导航栏-->
<nav class="navbar navbar-default navbar-inverse" role="navigation">
    <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse"
                data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span
                class="icon-bar"></span><span class="icon-bar"></span></button>
        <a class="navbar-brand" href="#">USSTKY</a>
    </div>

    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
            <li><a href="/mainpage">主页</a></li>
            <li><a href="/questions">题库</a></li>
            <li><a href="/courses">课程</a></li>
            <li class="更多">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">更多<strong class="caret"></strong></a>
                <ul class="dropdown-menu">
                    <li><a href="/feedbacks">我要反馈</a></li>
                    <li class="divider"></li>
                    <li><a href="/aboutus">关于我们</a></li>
                </ul>
            </li>
        </ul>
        <form class="navbar-form navbar-left" role="search">
            <div class="form-group">
                <input class="form-control" type="text" placeholder="站内查询"/>
            </div>
            <button type="submit" class="btn btn-default">查询</button>
        </form>
        <ul class="nav navbar-nav" style="position: absolute;right: 0">
            <!--             用户名，不需要链接地址-->
            <li><a th:if="${session.loginRole=='Teacher'}" th:text="${session.teacher.getName()}"></a></li>
            <li><a th:if="${session.loginRole=='Manager'}" th:text="${session.manager.getName()}"></a></li>
            <li><a th:if="${session.loginRole=='Student'}" th:text="${session.student.getName()}">李华</a></li>
            <!--             点击链接可注销-->
            <li><a href="#">注销</a></li>
        </ul>
    </div>
</nav>

<div class="container">
    <div class="row">
        <div class="col-md-6">

            <!--视频-->
            <div style="display: flex;flex-wrap: wrap;">
                <table class="table table-hover table-condensed">
                    <thead>
                    <th class="text-center"> 标题</th>
                    <th class="text-center">视频</th>
                    </thead>
                    <tr th:each="video:${videoLinks}">
                        <td style='vertical-align: middle;text-align: center;'>
                            <p class="lead" th:text="${video.getTitle()}">高等数学一</p>
                        </td>
                        <td th:ap>
                            <iframe th:src="${video.getLink()}" width="" scrolling="no"
                                    border="0" frameborder="no" framespacing="0" allowfullscreen="true"
                                    class="center-block" >
                            </iframe>
                        </td>
                    </tr>

                </table>
            </div>
        </div>
        <div class="col-md-6">
            <table id="table" class=" table table-bordered table-hover table-striped text-center"
                   style="margin-top: 50px">
                <thead>
                <tr>
                    <th class="text-center">留言人</th>
                    <th class="text-center">留言内容</th>
                    <th class="text-center">留言时间</th>
                    <th class="text-center">给个鼓励</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="message:${courseMessages}">
                    <td th:text="${message.getStudentID()}">小明</td>
                    <td th:text="${message.getMessageContent()}">很好的视频</td>
                    <td th:text="${message.getTime()}">2019-5-20</td>
                    <!--                点赞提交表单-->
                    <td>
                        <img th:id="'good'+${message.getID()}" src="../images/good_gray.png" alt="点赞"
                             onclick="clicklike(this)">

                    </td>
                </tr>
                </tbody>
            </table>
            <div>
                <!--发布留言表单-->
                <form role="form" id="message" action="/courses/detail/addmessage" method="post">
                    <div class="from-group">
                        <input type="text" name="留言内容" id="content" style="max-lines: 3" class="form-control"
                               placeholder="留言内容" required>
                        <input type="text" id="courseid" name="课程ID" class="form-control" style="display: none"
                               th:value="${courseInfo.getID()}" required>
                        <div th:switch="${session.student!=null}">
                            <input th:case="true" type="text" id="studentid" name="学生ID" class="form-control" style="display: none"
                                   th:value="${session.student.getID()}" required>
                            <input th:case="false" type="text" name="学生ID" class="form-control"
                                   th:value="nostudentid" required>
                        </div>
                        <br/>
                        <div class="row">
                            <div class="col-md-4"></div>
                            <div class="col-md-4 ">
                                <button type="submit" id="submit" class="btn btn-primary center-block">发布留言
                                </button>
                            </div>
                            <div class="col-md-4 ">
                                <button type="button" id="cancel" class="btn btn-default center-block">取消</button>
                            </div>
                        </div>
                    </div>
                </form>
                <button class="btn btn-primary center-block" data-toggle="modal" data-target="#myModal"
                        id="put">我要留言
                </button>
            </div>
        </div>
    </div>

</div>

<script>
    function clicklike(good) {
        // alert("点赞成功");
        var img = document.getElementById(good.id);
        console.log(good.id)
        console.log('img=' + img)
        img.src = "../images/good_blue.png";
    }

    $(document).ready(function () {
        $("#message").hide();
        $("#put").click(function () {
            if ($("input[name='学生ID']").val()=="nostudentid"){
                alert("未登录！");
                window.location.href="/login.html";
                return;
            }
                $(this).hide();
            $("#message").show(1000);
        })
        $("#submit").click(function () {
            if ($("#content").val() != "") {
                $("#message").hide(1000, 'linear', function () {
                    $("#content").val("");
                });
                $("#put").show();
                var myDate = new Date;
                var year = myDate.getFullYear();
                var month = myDate.getMonth() + 1;
                var day = myDate.getDate();
                $("#table").append('<tr>' + '<td>' + $("#studentid").val() + '</td>' + '<td>' +
                    $("#content").val() + '</td>' + '<td>' + year + '-' + month + '-' + day + '</td>' + '<td>' +
                    "<img th:id='${message.getID()}' src='../images/good_gray.png' alt='点赞'" +
                    "onclick='clicklike(this)'>" + "</td>" + "</tr>");
            }
        })

        $("#cancel").click(function () {
            $("#content").val("")
            $("#message").hide(1000);
            $("#put").show();
            // =====================;
            alert("ceshi")
        })
    })
</script>
</body>

</html>